# DEVELOPING

##  潜在问题

* [安全] 共识节点通过钱包地址和VDF信息运算来进行判断，存在共识节点伪造问题，需要实现VRF后进行认证
* [稳定性] 存在稳定性问题，需要对可能出现的错误进行预判，添加except语句来进行处理
* [一致性] 需要保证在一定时间内完成共识，需要保证在共识结束之后的一致性，能够根据最长链来同步

## Todo

* <del>数据库会报错 `Document update conflict`</del>
  > 需要添加线程锁， 在多线程的情况下会出现多个线程同时去操作数据库的情况
  > 
  > 数据库加锁可能影响性能， 暂且显示报错信息不影响节点程序正常运行即可
* 在创建区块时交易校验失败，但是可以创建区块，存在逻辑问题
  > 校验失败出现报错会直接返回上一个函数， 导致能够正常出块
  > 
  > 但是第一次校验成功而校验区块时校验出现问题
  > 
  > upd 2022/3/4:
  > 
  > 该问题没有复现处理， 后续如果出现问题再进行测试
* 交易检索时间复杂度o(n)， 需要进行优化
* couchdb考虑使用docker， 避免每次服务器都需要安装couchdb
  > 可以直接使用指令进行安装, 但是构建镜像后网络的连接存在问题
  > 
* server-client的连接存在问题, 在接收到交易时出现报错,待修复
* 对于没有同步完成的节点不参与共识（Server/Client端均要进行修改）
* 添加时间共识机制，保证节点能在正确的时间点进入共识或完成共识
* 交易广播方式改为使用UDP线程来进行处理
### 版本todo

#### v1.1.1

* 对Client/Server进行限制，在节点整体没有完成同步的的时候不参与进行共识
* 添加时间同步，保证节点在正确时间节点进入/完成共识

#### v1.1.2

* 交易数据迁移，保证在发送区块时发送交易，但是存储时将区块和交易分开（可能存在耗费I/O的问题）
* 完善rpc接口，添加地址交易查询及区块信息查询，完善explorer

## 2022/3/4

* main命令行测试函数中新增init函数
  > `python3 main.py init --node_id=2 --main_node=0`
* 修复了多线程的情况下client发送数据失败的问题
* 新增vote_center给多线程下的client进行信息发送

## 2022/3/6
* 修复未投票结束就产生区块的问题
* 新增了client和server的线程锁用于处理投票的问题（可能存在性能的影响， 需要进行优化）

## 2022/3/9
* client和server的投票信息专门由votecenter来进行处理
* 优化投票信息存储逻辑,新增线程用于处理投票信息(空间换时间)
* 减少client和server发请求的sleep时间, 提高一轮共识的速度

## 版本变更

### v1.0.0

项目重构完成版本，将区块链相关的数据结构放入到core中，网络节点相关结构放入到node中，工具类单独列入utils

### v1.0.1

添加了openapi，便于进行交易的发送和调试使用，openapi通过flask直接开一个新的服务进行处理

### v1.0.2

* 添加VoteCenter用于处理多线程下投票出现的问题
* 修复server保证和每一个client都有一次通信，避免和单个client信息一致导致的错误

### v1.0.3

* VoteCenter的改造，新增线程用于处理投票，避免多个线程等待锁导致的等待问题
* 添加docker配置文件，但是在docker下的网络存在问题，待修复

### v1.0.4

* openapi解耦，新增grpc用于rpc连接
* openapi通过flask去连接rpc获取数据，不再耦合到节点中
* rpc还可以便于后续cli和浏览器explorer的开发

### v1.1.0

* 修改交易池逻辑，通过高度来保证交易打包的正确，避免多个线程重复打包导致出现不同的区块
* 新增Timer来触发一轮共识，在一定间隔时间后进行一次共识，不再通过交易池满这个逻辑来进行判断
* 修改该逻辑后新区块的产生存在一定的问题，待修复
* merkle树逻辑存在问题：在超过数据量的情况下，右节点应该新增一个空节点，而非使用空字符串